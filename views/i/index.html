{{extend 'plantilla.html'}}

<h2>Entradas {{=project_name}}</h2>

{{

query = (db.income.project_uuid==request.vars.p) if request.vars.p else (db.income.id>0)
dd = db(query).select(db.income.amount.sum(),db.income.due_date,groupby=db.income.due_date)
data = [(str(i.income.due_date),i['SUM(income.amount)']) for i in dd]

meta_data_x = [d[0] for d in data]

data_x = "["
for m in meta_data_x:

data_x += '"%s",' % m

pass

data_x+= "]"

data_y = [int(d[1]) for d in data]

}}

<canvas id="myChart" width="1000px" height="400" style="margin:auto;"></canvas>

<script>
//Get the context of the canvas element we want to select
var ctx = document.getElementById("myChart").getContext("2d");


var data = {
	labels : {{=XML(data_x)}}, 
	datasets : [

		{
			fillColor : "rgba(151,187,205,0.5)",
			strokeColor : "rgba(151,187,205,1)",
			pointColor : "rgba(151,187,205,1)",
			pointStrokeColor : "#fff",
			data : {{=data_y}}
		}
	]
}

var myNewChart = new Chart(ctx).Line(data);
</script>


{{=form}}
<h2>Total: 
{{=int(sum([d.income.amount for d in dataset]))}}
</h2>
<table class="table table-striped">
<thead>
  <tr>
    <th>Monto</th>
    <th>Fecha</th>
    <th>Hecho</th>
    <th></th>
  </tr>
</thead>

<tbody>

{{for d in dataset:}}

<tr>
  <td>{{=d.income.amount}}</td>
  <td>{{=d.income.due_date}}</td>
  <td>{{=d.income.done}}</td>
  <td><a class="btn btn-danger" href="{{=URL(args=d.income.id,vars={'p':d.income.project_uuid})}}">Editar</a></td>
</tr>

{{pass}}

</tbody>
</table>

